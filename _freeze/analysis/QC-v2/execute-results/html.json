{
  "hash": "a5160de4200b49c3d8f298affcad6831",
  "result": {
    "markdown": "---\ntitle: \"QC\"\nauthor: \"Chao Dai\"\ndate: \"7/28/22 (modified: 2023-03-24)\"\neditor_options:\n  chunk_output_type: inline\n---\n\n\n\n\n\n## Library Description\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# config yaml\nconfig = yaml.load_file(\"../code/config/config.yaml\")\n\n# sample sheets\nss = list(rna = fread(paste0(\"../code/\", config$RNA_SAMPLES)),\n          atac = fread(paste0(\"../code/\", config$ATAC_SAMPLES))\n          )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nss$rna = ss$rna[, .(\n  library = \"rna-seq\",\n  batch = if_else(batch == \"A\", 1, 2),\n  sampleid = sample,\n  condition = paste(treatment, time, sep=\"-\")\n)] %>% unique\n\nss$atac = ss$atac[, .(\n  library = \"atac-seq\", \n  batch = 1,\n  sampleid = paste(\"S\", str_match(fastq, \"ATAC([0-9]{1,2})\")[, 2], sep=\"\"),\n  condition = paste(\"wt\", time, sep=\"-\")\n)] %>% unique\n\nss = rbindlist(ss)\n\n# bam flagstats\nflagstat = dir(\"../code/results/QC/flagstat\", '*txt', recursive = T, full.names = T)\nflagstat_meta = str_match(flagstat, \"([rnatc]{3,4}-seq).+(batch[1/2]).+(S[0-9]{2})\")  %>% as.data.table\nflagstat_meta = flagstat_meta[, .(\n  library = V2,\n  batch = str_extract(V3, \"[0-9]{1}\") %>% as.numeric,\n  sampleid = V4,\n  file = flagstat\n)] %>% unique\n\n\n# join\nflagstat_meta = ss[flagstat_meta, on = c(\"library\", \"batch\", \"sampleid\"), nomatch = NA]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# library size = primary mapped reads\nflagstat_meta[, data := map(file, fread)]\n\nlib_size1 = flagstat_meta[, .(\n  description = paste(library, condition, sep = \"::\"),\n  library,\n  batch,\n  sampleid,\n  condition,\n  primary_mapped = map_dbl(data, ~ .x$V1[[9]] %>% as.numeric)\n)][order(description), .(size = sum(primary_mapped)), by = \"description\"] \n\nlib_size2 = flagstat_meta[, .(\n  description = paste(library, condition, sep = \"::\"),\n  library,\n  batch,\n  sampleid,\n  condition,\n  primary_mapped = map_dbl(data, ~ .x$V1[[9]] %>% as.numeric)\n)][, .(size = sum(primary_mapped)), by = \"library\"]\n\nlib_size3 = flagstat_meta[, .(\n  library,\n  batch,\n  sampleid,\n  condition,\n  primary_mapped = map_dbl(data, ~ .x$V1[[9]] %>% as.numeric)\n)][order(library, condition, sampleid), .(size = sum(primary_mapped)), by = .(library, condition, sampleid)]\n```\n:::\n\n\nOverall we generated 602,272,627 primarily mapped reads for the ATAC-seq library and 273,173,427 primarily mapped reads for the RNA-seq library ( table \\@ref(tab:table1).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# total library size\nlib_size2[, .(library, size = scales::comma(size))] #%>% knitr::kable(., caption = \"Total library size\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    library        size\n1: atac-seq 602,272,627\n2:  rna-seq 273,173,427\n```\n:::\n:::\n\n\n\nDetailed library size in table \\@ref(tab:table2)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# library size by condition\nlib_size1[, .(description,\n              size = scales::comma(size)\n                )] \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         description        size\n 1:  atac-seq::wt-d1 145,203,102\n 2:  atac-seq::wt-d5  86,612,423\n 3:  atac-seq::wt-es  89,820,545\n 4:  atac-seq::wt-h1  93,772,813\n 5: atac-seq::wt-h16  82,710,864\n 6:  atac-seq::wt-h4 104,152,880\n 7: rna-seq::k108-d4  21,564,934\n 8: rna-seq::k108-es  22,591,656\n 9: rna-seq::k112-d4  24,190,413\n10: rna-seq::k112-es  33,760,481\n11:   rna-seq::wt-d1  25,727,105\n12:   rna-seq::wt-d2  25,784,430\n13:   rna-seq::wt-d4  21,655,783\n14:   rna-seq::wt-d7  19,337,421\n15:   rna-seq::wt-es  52,242,551\n16:  rna-seq::wt-h15  26,318,653\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlib_size3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     library condition sampleid     size\n 1: atac-seq     wt-d1      S09 86433463\n 2: atac-seq     wt-d1      S10 58769639\n 3: atac-seq     wt-d5      S11 45593714\n 4: atac-seq     wt-d5      S12 41018709\n 5: atac-seq     wt-es      S01 47160567\n 6: atac-seq     wt-es      S02 42659978\n 7: atac-seq     wt-h1      S03 47790998\n 8: atac-seq     wt-h1      S04 45981815\n 9: atac-seq    wt-h16      S07 39407650\n10: atac-seq    wt-h16      S08 43303214\n11: atac-seq     wt-h4      S05 42795268\n12: atac-seq     wt-h4      S06 61357612\n13:  rna-seq   k108-d4      S09 13009210\n14:  rna-seq   k108-d4      S10  8555724\n15:  rna-seq   k108-es      S03  9575107\n16:  rna-seq   k108-es      S04 13016549\n17:  rna-seq   k112-d4      S11  9805283\n18:  rna-seq   k112-d4      S12 14385130\n19:  rna-seq   k112-es      S05 14726059\n20:  rna-seq   k112-es      S06 19034422\n21:  rna-seq     wt-d1      S17 12845991\n22:  rna-seq     wt-d1      S18 12881114\n23:  rna-seq     wt-d2      S19 12064070\n24:  rna-seq     wt-d2      S20 13720360\n25:  rna-seq     wt-d4      S07  7307671\n26:  rna-seq     wt-d4      S08 14348112\n27:  rna-seq     wt-d7      S21  8518963\n28:  rna-seq     wt-d7      S22 10818458\n29:  rna-seq     wt-es      S01 11492703\n30:  rna-seq     wt-es      S02 12942704\n31:  rna-seq     wt-es      S13 14631896\n32:  rna-seq     wt-es      S14 13175248\n33:  rna-seq    wt-h15      S15 13690829\n34:  rna-seq    wt-h15      S16 12627824\n     library condition sampleid     size\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "5712fa8ad2012bc74a879af3793d90cb",
  "result": {
    "markdown": "---\ntitle: \"Compare interaction output files\"\nauthor: Chao\ndate: today\ncode-fold: true\nexecute: \n  warning: false\n---\n\n\n## Introduction\n\nCompare interaction files computed from before (2020) and recomputed now with essentially same code. The purpose is to make sure the results are consistent.\n\n\n\n\n\n## Compare interactions (genebody) from current run with run in 2020\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninter.mx.old = \"../code/resources/TFscreen/Interaction_matrix_nofilter_AllTF_20200107.csv\"\ninter.mx.old = fread(inter.mx.old)\n\ninter.mx.new = \"../code/results/reviews/interactions/Interaction_matrix_nofilter_AllTF_genebody_20230111.csv\"\ninter.mx.new = fread(inter.mx.new)\n```\n:::\n\n\ndifferences in total interaction pairs?\n\n::: {.cell}\n\n```{.r .cell-code}\ninteractions = map(\n  list(old = inter.mx.old, new = inter.mx.new),\n  ~ .x[, .(interaction = paste(regulator_gene, target_gene, sep=\"_\"))] %>% \n    .[, interaction] %>% unique\n)\n\nmap_int(interactions, length)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   old    new \n217560 214684 \n```\n:::\n:::\n\n\nIntersections of the two is exactly the same number as the length of new interactions. Thus new is a subset of old.\n\n::: {.cell}\n\n```{.r .cell-code}\nreduce(interactions, intersect) %>% length\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 214684\n```\n:::\n\n```{.r .cell-code}\nsetdiff(interactions$new, reduce(interactions, intersect)) %>% length\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n:::\n\n\n\nWhat interactions in the old not found in new?\nOnly about 26 targets comprise genes missed out in the new run.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(\"Regulators of interactions not found in new:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Regulators of interactions not found in new:\"\n```\n:::\n\n```{.r .cell-code}\nsetdiff(interactions$old, interactions$new) %>%\n  str_split(\"_\", simplify = T) %>% \n  as.data.table %>% \n  pull(V1) %>% unique %>% length\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 451\n```\n:::\n\n```{.r .cell-code}\nprint(\"Targets of interactions not found in new:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Targets of interactions not found in new:\"\n```\n:::\n\n```{.r .cell-code}\nsetdiff(interactions$old, interactions$new) %>%\n  str_split(\"_\", simplify = T) %>% \n  as.data.table %>% \n  pull(V2) %>% unique\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"CAVIN1\" \"ELOA\"   \"FCMR\"   \"H1-3\"   \"H2BC15\" \"H2BC9\"  \"MRTFB\"  \"NOCT\"  \n [9] \"SLF1\"   \"NSD3\"   \"MRTFA\"  \"NSD2\"   \"CRAMP1\" \"H1-5\"   \"H2BC21\" \"H1-4\"  \n[17] \"H2BC5\"  \"ELOC\"   \"H2BC4\"  \"TLE5\"   \"NSMCE3\" \"ZNF875\" \"H1-2\"   \"H2BC11\"\n[25] \"ELOB\"   \"H1-10\"  \"H1-0\"  \n```\n:::\n:::\n\n\nAre the numbers about the same in the new run?\n\nRandomly pick 7 values, show that the difference is almost always 0. Plot shows that\nthe two runs are mostly exactly the same. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ninter.mx.old[, interaction := paste(regulator_gene, target_gene, sep=\"_\")]\ninter.mx.new[, interaction := paste(regulator_gene, target_gene, sep=\"_\")]\n\n# common sets\ninter.mx = list(\n  old = inter.mx.old[interaction %in% reduce(interactions, intersect)][\n    order(interaction)],\n  new = inter.mx.new[interaction %in% reduce(interactions, intersect)][\n    order(interaction)]\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# check atac.D4\nif (all(inter.mx$old$interaction == inter.mx$new$interaction)) {\n  comps = list(\n  atac.D4.diff = round(inter.mx$old$atac.D4 - inter.mx$new$atac.D4),\n  atac.cnt.D1.diff = round(inter.mx$old$atac.cnt.D1 - inter.mx$new$atac.cnt.D1),\n  tar.cnt.ES.diff = round(inter.mx$old$tar.ge.ES - inter.mx$new$tar.ge.ES),\n  tar.ge.H16.diff = round(inter.mx$old$tar.ge.H16 - inter.mx$new$tar.ge.H16),\n  reg.fdr.D4 = round(inter.mx$old$reg.fdr.D4 - inter.mx$new$reg.fdr.D4, digits = 2),\n  tar.l2fc.D1 = round(inter.mx$old$l2fc.D1 - inter.mx$new$tar.l2fc.D1, digits = 2),\n  corr = round(inter.mx$old$corr - inter.mx$new$corr, digits = 2)\n  ) %>% as.data.table\n}\n\nmelt(comps, variable.name = \"type\", value.name = \"diff\") %>%\n  ggplot() + stat_ecdf(aes(diff, color = type))\n```\n\n::: {.cell-output-display}\n![](compare_interaction_files_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "compare_interaction_files_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}